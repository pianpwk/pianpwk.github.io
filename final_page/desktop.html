<!DOCTYPE html>
<meta charset="utf-8">

<body>

    <div>
        <div id="header">
            <div id="header-suptitle">THE CABINET DYNASTY</div>
            <div id="header-title">
                ครม.ไทย เปลี่ยนฝ่าย
                <br />ย้ายข้างมากน้อยแค่ไหน ?
            </div>
            <div id="header-subtitle">มาดูกันว่า ครม.คนไหนอยู่ขั้วไหน เมื่อไหร่ในประวัติศาสตร์การเมืองไทย</div>
        </div>

        <hr width="46.8%" />

        <div id="intro">
            <div class="intro-text" style="padding-top: 75px;">
                คณะรัฐมนตรี (ครม.) นับเป็นตำแหน่งสำคัญในกระบวนการบริหารของรัฐบาล และการเมือง
                การปกครองของประเทศ เก้าอี้ครม. ในแต่ละยุคสมัยทางการเมือง ถูกแต่งตั้ง โยกย้าย
                ปรับเปลี่ยนไปด้วยหลายเหตุผลและปัจจัย ทั้งความเหมาะสม ความรู้ความสามารถ
                <br>
                หลายครั้งเก้าอี้ครม.ก็เป็นเครื่องมือต่อรองทางการเมืองที่มีไว้จัดสรรระหว่างกลุ่มอำนาจร่วม
                รัฐบาล ที่อาจส่งผลต่อเสถียรภาพ และการทำงานของรัฐบาลได้เช่นกัน
            </div>
            <div class="intro-text" style="padding-top: 40px;">ELECT ได้ลองนำข้อมูลคณะรัฐมนตรี ตลอด 13 ปีที่ผ่านมา
                โดยเลือกช่วงเวลานับตั้งแต่เกิด วิกฤตเศรษฐกิจครั้งใหญ่ในปีพ.ศ. 2540 มาจนถึงปี พ.ศ. 2563
                ในรัฐบาลพลเอกประยุทธ์ จันทร์โอชา</div>
            <div class="intro-text" style="padding-top: 40px; text-align: center;">โดยสามารถแบ่งขั้วการเมืองออกได้เป็น 3
                ขั้วหลักๆ
            </div>
            <div id="intro-split-box">
                <div id="intro-split-box-1">
                    <div id="intro-split-box-title-1">
                        1. กลุ่มครม.<br> ที่มีความยึดโยงกับพรรคการเมือง
                    </div>
                    <img src="page/src/assets/images/intro-split-box-1.png" width="195px"
                        style="position: absolute; top: 70px; left: calc(50% - 96px);" />
                </div>
                <div id="intro-split-box-2">
                    <div id="intro-split-box-title-2">
                        2. กลุ่มครม.ลื่นไหล
                    </div>
                    <img src="page/src/assets/images/intro-split-box-2.png" width="207px"
                        style="position: absolute; top: 70px; left: calc(50% - 103px);" />
                </div>
            </div>
            <div id="intro-boxes-core">
                <div class="intro-box-core" style="background-color: #ff0017; left: 0px;">ขั้วทักษิณ</div>
                <div class="intro-box-core" style="background-color: #36bed9; position: absolute; left: 190px;">ขั้วประชาธิปัตย์</div>
                <div class="intro-box-core" style="background-color: #00ab7c; position: absolute; right: 0px;">ขั้วทหาร</div>
            </div>
            <div class="intro-text" style="padding-top: 40px; text-align: center;">
                และสามารถแบ่งประเภทรัฐมนตรีตามขั้วที่เคยสังกัดได้เป็น 2 กลุ่มใหญ่ๆ</div>

            <div class="intro-text" style="padding-top: 40px; text-align: center;">
                เมื่อลองสังเกตการ “เชื่อมโยง เปลี่ยนถ่าย ย้ายข้าง” ของครม.ในแต่ละชุดแต่ละสมัย
                ผ่านการใช้ Data Visualization มาแสดงให้เห็นความเชื่อมโยง ของครม.แต่ละคน
                ตามช่วงเวลา จะสามารถอธิบายกลุ่มก้อนทางการเมือง ได้ดังนี้
            </div>

            <div id="intro-lottie">
            </div>
        </div>

        <div id="part-1">
            <div class="part-title">
                1.
                <br />กลุ่มครม.ที่มีความยึดโยงกับพรรคการเมือง
            </div>
            <div id="part-1-headrow-1">
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/จาตุรนต์-ฉายแสง.jpg" />
                    <div class="headtext">จาตุรนต์ ฉายแสง</div>
                </div>
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/อุไรวรรณ-เทียนทอง.jpeg" />
                    <div class="headtext">อุไรวรรณ เทียนทอง</div>
                </div>
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/โกวิท-วัฒนะ.jpg" />
                    <div class="headtext">โกวิท วัฒนะ</div>
                </div>
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/สุชาติ-ธาดาธำรงเวช.jpg" />
                    <div class="headtext">สุชาติ ธาดาธำรงเวช</div>
                </div>
            </div>
            <div class="part-text" style="padding-top: 40px;">
                เรียกได้ว่าเป็นกลุ่มครม.เพื่อนทักษิณ ด้วยตำแหน่งรัฐมนตรีในรัฐบาลที่ยึดโยงกับพรรค
                ไทยรักไทยของทักษิณ ชินวัตร โดยไม่ย้ายสังกัดไปฝั่งใด
            </div>
            <img id="part-1-img1" src="page/src/assets/images/part-1-img1.png" width="90%"
                style="position: relative; padding-top: 40px;" />
            <hr width="46.8%" style="border: 2px dashed #828282; top: 40px; position: relative;" />
            <div class="part-text" style="padding-top: 40px;">เช่นเดียวกันกับ</div>
            <div id="part-1-headrow-2">
                <div class="headbox" style="left: 0px;">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/สุเทพ-เทือกสุบรรณ.jpg" />
                    <div class="headtext">สุเทพ เทือกสุบรรณ</div>
                </div>
                <div class="headbox" style="right: 0px; position: absolute;">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/ไพฑูรย์-แก้วทอง.jpg" />
                    <div class="headtext">ไพฑูรย์ แก้วทอง</div>
                </div>
            </div>
            <div class="part-text" style="padding-top: 40px;">ที่ยึดโยงกับพรรคประชาธิปัตย์มาอย่างแนบแน่น</div>
            <img id="part-1-img2" src="page/src/assets/images/part-1-img2.png" width="90%"
                style="position: relative; padding-top: 40px;" />
            <hr width="46.8%" style="border: 2px dashed #828282; top: 40px; position: relative;" />
            <div class="part-text" style="padding-top: 40px;">ในขณะที่</div>
            <div id="part-1-headrow-3">
                <div class="headbox" style="left: 0px;">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/อนุพงษ์-เผ่าจินดา.jpg" />
                    <div class="headtext">อนุพงษ์ เผ่าจินดา</div>
                </div>
                <div class="headbox" style="right: 0px; position: absolute;">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/ชัยชาญ-ช้างมงคล.jpg" />
                    <div class="headtext">ชัยชาญ ช้างมงคล</div>
                </div>
            </div>
            <div class="part-text" style="padding-top: 40px;">อยู่ในครม.ขั้วทหาร ที่มีตำแหน่งในรัฐบาลขั้วทหารอย่างต่อเนื่อง
            </div>
            <img id="part-1-img3" src="page/src/assets/images/part-1-img3.png" width="90%"
                style="position: relative; padding-top: 40px;" />
        </div>

        <div id="part-2">
            <div class="part-title">
                2.
                <br />กลุ่มครม. ลื่นไหล
            </div>
            <div class="part-text" style="padding-top: 40px;">
                เนื่องด้วยรัฐบาลส่วนมากในประวัติศาสตร์เป็นรัฐบาลแบบผสมหลายพรรค
                ดังนั้นจึงเกิดการจัดสรรเก้าอี้ครม.ตามโควต้าต่างๆเพื่อให้แต่ละพรรคได้รับเก้าอี้ตามเสียงสนับ
                สนุน หรือในบางกรณีถูกเชิญเข้ามาดำรงตำแหน่งในหลายครม.
                ครม.กลุ่มนี้สามารถแบ่งออกมาได้เป็นหลายแขนง
            </div>
            <div class="part-2-subtitle" style="padding-top: 40px;">2.1. กลุ่มสามมิตร (ขั้วทักษิณ ย้ายไป ขั้วทหาร)</div>
            <div id="part-2-headrow-1">
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/สมศักดิ์-เทพสุทิน.jpg" />
                    <div class="headtext">สมศักดิ์ เทพสุทิน</div>
                </div>
                <div class="headbox">
                    <img class="headshot"
                        src="page/src/assets/images/politician-photos-crop/สุริยะ-จึงรุ่งเรืองกิจ.jpg" />
                    <div class="headtext">สุริยะ จึงรุ่งเรื่องกิจ</div>
                </div>
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/สันติ-พร้อมพัฒน์.jpg" />
                    <div class="headtext">สันติ พร้อมพัฒน์</div>
                </div>
            </div>
            <div class="part-text" style="padding-top: 40px;">
                เป็นสมาชิกกลุ่มส.ส.ที่มีอิทธิพล โดยเรียกตนเองว่ากลุ่มสามมิตร โดยล้วนเป็นส.ส.ในขั้วทักษิณ
                ที่ย้ายข้างมาอยู่พรรคพลังประชารัฐและก่อตั้งรัฐบาลได้สำเร็จ
            </div>
            <img id="part-2-img1" src="page/src/assets/images/part-2-img1.png" width="90%"
                style="position: relative; padding-top: 40px;" />
            <div class="part-2-subtitle" style="padding-top: 40px;">2.2. กลุ่มประชาธิปัตย์ร่วมรัฐบาลประยุทธ์</div>
            <div id="part-2-headrow-2">
                <div class="headbox">
                    <img class="headshot"
                        src="page/src/assets/images/politician-photos-crop/จุรินทร์-ลักษณวิศิษฎ์.jpg" />
                    <div class="headtext">จุรินทร์ ลักษณวิศิษฏ์</div>
                </div>
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/กัลยา-โสภณพนิช.jpg" />
                    <div class="headtext">กัลยา โสภณพนิช</div>
                </div>
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/จุติ-ไกรฤกษ์.jpg" />
                    <div class="headtext">จุติ ไกรฤกษ์</div>
                </div>
            </div>
            <div class="part-text" style="padding-top: 40px;">
                หลังจากพรรคประชาธิปัตย์ตบเท้าร่วมรัฐบาลประยุทธ์ 2 ก็ได้รับการจัดสรรที่นั่งรัฐมนตรี
                ชื่อของทั้ง 3 คนนี้ ต่างปรากฏในชื่อของรัฐมนตรีกระทรวงสำคัญ
            </div>
            <img id="part-2-img2" src="page/src/assets/images/part-2-img2.png" width="90%"
                style="position: relative; padding-top: 40px;" />
            <div class="part-2-subtitle" style="padding-top: 40px;">2.3. กลุ่มเนติบริกร และเทคโนแครต</div>
            <div id="part-2-headrow-3">
                <div class="headbox">
                    <img class="headshot"
                        src="page/src/assets/images/politician-photos-crop/สมคิด-จาตุศรีพิทักษ์.jpg" />
                    <div class="headtext">สมคิด จาตุศรีพิทักษ์</div>
                </div>
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/วิษณุ-เครืองาม.jpg" />
                    <div class="headtext">วิษณุ เครืองาม</div>
                </div>
                <div class="headbox">
                    <img class="headshot"
                        src="page/src/assets/images/politician-photos-crop/หม่อมราชวงศ์ปรีดิยาธร-เทวกุล.jpg" />
                    <div class="headtext">ม.ร.ว.ปรีดิยาธร เทวกุล</div>
                </div>
            </div>
            <div class="part-text" style="padding-top: 40px;">
                เป็นตัวอย่างของกลุ่มนักวิชาการทางกฎหมายและเทคโนแครต
                ที่เข้ามากุมตำแหน่งสำคัญๆในรัฐบาลหลายสมัย ทั้งรัฐบาลที่มาจากการเลือกตั้ง
                และรัฐบาลจัดตั้งภายหลังจากการรัฐประหาร
            </div>
            <img id="part-2-img3" src="page/src/assets/images/part-2-img3.png" width="90%"
                style="position: relative; padding-top: 40px;" />
            <div class="part-2-subtitle" style="padding-top: 40px;">2.4. กลุ่มพรรคขนาดกลาง</div>
            <div id="part-2-headrow-4">
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/สนธยา-คุณปลื้ม.jpg" />
                    <div class="headtext">สนธยา คุณปลื้ม</div>
                </div>
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/ชุมพล-ศิลปอาชา.jpeg" />
                    <div class="headtext">ชุมพล ศิลปอาขา</div>
                </div>
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/เนวิน-ชิดชอบ.png" />
                    <div class="headtext">เนวิน ชิดชอบ</div>
                </div>
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/อนุทิน-ชาญวีรกูล.jpg" />
                    <div class="headtext">อนุทิน ชาญวีรกูล</div>
                </div>
            </div>
            <div class="part-text" style="padding-top: 40px;">
                รายชื่อนี้เป็นเพียงตัวอย่างของกลุ่มครม.ที่มาจากพรรคขนาดกลาง หรือมีชื่อเสียงจากการเป็น
                นักการเมืองที่มีอิทธิพลในท้องถิ่น กลุ่มครม.เหล่านี้มีลักษณะการย้ายข้างที่ลื่นไหลกว่า
                กลุ่มอื่นๆ โดยสามารถใช้ที่นั่งส.ส. ที่ตนมีมาใช้แลกโควต้าเก้าอี้ครม.ในรัฐบาลทุกยุคทุกสมัย
                โดยเฉพาะในรัฐธรรมนูญ พ.ศ. 2560 ที่ระบบการเลือกตั้งเพิ่มอำนาจให้พรรคขนาดกลาง
            </div>
            <img id="part-2-img4" src="page/src/assets/images/part-2-img4.png" width="90%"
                style="position: relative; padding-top: 40px;" />
        </div>

        <hr width="46.8%" color="black" />

        <div id="narrative-intro">
            <div id="narrative-intro-text-1">
                ในส่วนนี้ เราสามารถลอง Explore ข้อมูลการเปลี่ยนถ่าย โยกย้ายของครม. แต่ละคน แต่ละชุดได้ด้วยตัวเอง
            </div>
            <div id="narrative-intro-text-2">
                หมายเหตุ : ELECT ได้เลือกนำเสนอข้อมูลเฉพาะรายชื่อของสมาชิกครม.ที่ปรากฏตำแหน่งในคณะรัฐมนตรีมากกว่า 2
                ชุดขึ้นไป
            </div>
        </div>

        <div id="narrative-1">
        </div>
        <div id="narrative-1-card">
            <div id="li-charcard">
                <div id="li-charcard-name"></div>
                <!-- <div id="charcard-t1"></div> -->
                <a href="www.google.com" id="li-charcard-b1">
                    อ่านประวัติเพิ่มเติม
                </a>
                <img id="li-charcard-img" />
                <div id="li-charcard-subtext1">
                    ชุดที่
                </div>
                <div id="li-charcard-subtext2">
                    กระทรวงที่สังกัด
                </div>
                <div id="li-charcard-expand">
                    <div id="li-charcard-expand-title"></div>
                    <!-- <div id="charcard-expand-content"> -->
                    <svg id="li-charcard-expand-content-svg"></svg>
                    <!-- </div> -->
                </div>
                <text id="li-charcard-t2"></text>
            </div>
            <div id="li-scenecard">
                <text id="li-scenecard-name"></text>
                <text id="li-scenecard-t1"></text>
                <img id="li-scenecard-img" />
                <div id="li-scenecard-ac"></div>
                <text id="li-scenecard-t2"></text>
            </div>
        </div>

        <div id="intermission">
            <div id="intermission-title">ย้ายข้าง เปลี่ยนขั้ว มากน้อยแค่ไหน?</div>
            <div id="intermission-text">
                เมื่อลองนำรายชื่อครม. มาวางลงบนขั้วฐานอำนาจให้เห็นตามระยะเวลา
                จะสามารถสังเกตไทม์ไลน์ของการย้ายข้างตั้งแต่อดีตถึงปัจจุบัน
            </div>
            <div id="intermission-subtext">
                วงกลมแต่ละวง = รัฐมนตรี 1 คน | ขนาดวงกลม = จำนวนสมัยที่ดำรงตำแหน่ง ขนาดยิ่งใหญ่ ยิ่งอยู่นาน
                สามารถกดวงกลมเพื่อดูชื่อรัฐมนตรี และ เลื่อนแถบด้านล่างเพื่อดูการเปลี่ยนแปลงตามช่วงเวลา
            </div>
        </div>

        <div id="narrative-2">
            <div id="narrative-2-svg">
            </div>
        </div>

        <div id="outro">
            <div id="outro-headrow-1">
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/สุวิทย์-คุณกิตติ.jpg" />
                    <div class="headtext">สุวิทย์ คุณกิตติ</div>
                </div>
            </div>
            <div class="outro-text" style="padding-top: 40px;">
                คือ
                <b>คนที่อยู่หลายครม. มากที่สุด</b>
                <br />มีสถิติอยู่ในครม.กว่า 5 ชุด ใน 4 รัฐบาล ตั้งแต่สมัย ชวน หลีกภัย, ทักษิณ ชินวัตร, สมัคร
                สุนทรเวช ไปจนถึงรัฐบาล อภิสิทธิ์ เวชชาชีวะ
                <br /><b>โดยสามารถสังเกตุได้จากขนาดของวงกลมที่ใหญ่ที่สุด</b>
            </div>
            <div id="outro-headrow-2">
                <div class="headbox">
                    <img class="headshot"
                        src="page/src/assets/images/politician-photos-crop/สุริยะ-จึงรุ่งเรืองกิจ.jpg" />
                    <div class="headtext">สุริยะ จึงรุ่งเรืองกิจ</div>
                </div>
                <div class="headbox">
                    <img class="headshot" src="page/src/assets/images/politician-photos-crop/สมศักดิ์-เทพสุทิน.jpg" />
                    <div class="headtext">สมศักดิ์ เทพสุทิน</div>
                </div>
            </div>
            <div class="outro-text" style="padding-top: 40px;">
                คือ
                <b>คนที่ย้ายขั้วทางการเมืองมากที่สุด</b>
                อยู่ครบ-ขั้วการเมืองทั้ง 3 ขั้ว นับตั้งแต่รัฐบาลชวน หลีกภัย ทักษิณ ชินวัตร ไปจนถึง ประยุทธ์
                จันทร์โอชาในปัจจุบัน<br>
                <b>วงกลมทั้งสองคนจะอยู่ในกลางสามเหลี่ยม
                    แสดงให้เห็นถึงการไม่เอนเอียงไปข้างใดข้างหนึ่ง</b>
            </div>
        </div>

        <hr width="46.8%" color="black" />

        <div id="bibliography">
            <div id="bibliography-title">แหล่งข้อมูลอ้างอิง</div>
            <div id="bibliography-text">
                <ul>
                    <li>คริส เบเคอร์ และ ผาสุก พงษ์ไพจิตร, ประวัติศาสตร์ไทยร่วมสมัย, หน้า xx</li>
                    <li><a href="https://www.prachachat.net/politics/news-345654">https://www.prachachat.net/politics/news-345654</a></li>
                    <li><a href="https://ilaw.or.th/node/5229">https://ilaw.or.th/node/5229</a></li>
                    <li><a href="https://th.wikipedia.org/wiki/สุวิทย์_คุณกิตติ">https://th.wikipedia.org/wiki/สุวิทย์_คุณกิตติ</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- main browser content -->
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.5.3/lottie.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- <script src="require.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-shim.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.35.0/es6-shim.js"></script>
    <script src="narrative.js"></script>

    <script>
        d3.json('page/src/assets/chart-animate.json', function (err, response) {
            const animation = bodymovin.loadAnimation({
                container: document.getElementById('intro-lottie'),
                renderer: 'svg',
                loop: true,
                autoplay: true,
                animationData: response
            })
        })
    </script>

    <!-- line narrative -->

    <script>
        // Request the data
        d3.json('crm_fine_multicrm.json', function (err, response) {

            console.log(response)

            var codeColors = {
                '100': '#00ab7c', // ทหาร
                '010': '#ff0017', // ทักษิณ
                '001': '#36bed9', // ปชป
                '110': '#923e1b', // ทหาร + ทักษิณ
                '101': '#358295', // ทหาร + ปชป
                '011': '#7168ca', // ทักษิณ + ปชป
                '111': '#000000' // ทหาร + ทักษิณ + ปชป
            }

            var coreColors = {
                'army': '#00ab7c',
                'thaksin': '#ff0017',
                'democrat': '#36bed9'
            }

            var name2code = {}
            response.characters.forEach(function (d) {
                name2code[d.name.split(' ').join('_')] = d.code
            })

            var svg, scenes, charactersMap, width, height, sceneWidth, headerShift;

            // Get the data in the format we need to feed to d3.layout.narrative().scenes
            scenes = wrangle(response);
            // Format: list of scenes:
            // Scene: {characters: [list of character objects]}
            // Character: {id, name, affiliation}

            // Some defaults
            sceneWidth = 76;
            headerShift = 158;
            width = scenes.length * sceneWidth + 2000;
            height = 600;
            labelSize = [sceneWidth, 14];
            var topPadding = 30;

            var clickedChar = false;
            var clickedScene = false;

            var opacity1 = 1.0;
            var opacity2 = 0.3;
            var opacity_change = 0.6;

            var strokedash = 1;

            // The container element (this is the HTML fragment);
            svg = d3.select("#narrative-1").append('svg')
                .attr('id', 'li-narrative-chart')
                .attr('width', width)
                .attr('height', height + topPadding);

            // Calculate the actual width of every character label.
            scenes.forEach(function (scene) {
                scene.characters.forEach(function (character) {
                    character.width = svg.append('text')
                        .attr('opacity', 0)
                        .attr('class', 'temp')
                        .text(character.name)
                        .node().getComputedTextLength() + 10;
                });
            });

            // Remove all the temporary labels. 
            svg.selectAll('text.temp').remove();
            // only adds ".width" attribute to character objects

            // Do the layout
            narrative = d3.layout.narrative()
                .scenes(scenes)
                .size([width, height])
                .pathSpace(labelSize[1])
                .groupMargin(10)
                .labelSize(labelSize)
                .scenePadding([5 + topPadding, sceneWidth / 2, 5 + topPadding, sceneWidth / 2])
                .labelPosition('left')
                .layout();
            // This function assigns multiple values to scenes

            // Get the extent so we can re-size the SVG appropriately.
            // svg.attr('height', narrative.extent()[1]);

            var y_eps = 8;
            // Draw links
            svg.selectAll('.link').data(narrative.links().slice().reverse()).enter()
                .append('path')
                .attr('class', function (d) {
                    return 'link ' + d.character.affiliation.toLowerCase();
                })
                .attr('d', narrative.link(height, width, y_eps))
                .attr("id", function (d, i) {
                    return "link-" + d.character.id.split(' ').join('_') + "-" + i
                })
                // .style("stroke-dasharray", narrative.link_dash(strokedash))
                .style("stroke-opacity", narrative.link_opacity(opacity1, opacity2))
                .style("stroke", function (d) {
                    return codeColors[d.character.code];
                })

            // MERGE PATHS
            var new_paths = []
            var last_xy = ""
            var last_color = ""
            var last_opacity = ""
            var last_id = ""
            var curr_path = ""
            d3.selectAll("path")._groups[0].forEach(function (path, i) {
                // console.log(path)
                var d = path.getAttribute("d")
                var dxy_last = d.split(" ").slice(-1)[0]
                var dxy_first = d.split("C")[0].split("M")[1]
                d = "M" + (parseFloat(d.split(',')[0].split('M')[1]) - 3) + ',' + d.split(',').slice(1,).join(',')
                d = d.split(' ').slice(0, -1).join(' ') + ' ' + (parseFloat(d.split(' ').slice(-1)[0].split(',')[0]) + 3) + ',' + d.split(',').slice(-1)[0]

                if (last_xy == dxy_last && last_color == path.style['stroke'] && last_opacity == path.style['stroke-opacity']) {
                    curr_path = d + " " + curr_path
                } else {
                    if (curr_path !== "") {
                        new_paths.push({
                            'd': curr_path,
                            'stroke': last_color,
                            'stroke-opacity': parseFloat(last_opacity),
                            'id': last_id
                        })
                    }
                    curr_path = d
                }
                last_xy = dxy_first
                last_color = path.style['stroke']
                last_opacity = path.style['stroke-opacity']
                last_id = path.getAttribute("id").split('-')[1] + '-' + i
            })
            if (curr_path !== "") {
                new_paths.push({
                    'd': curr_path,
                    'stroke': last_color,
                    'stroke-opacity': parseFloat(last_opacity),
                    'id': last_id
                })
            }

            var name2scenes = {}
            response.characters.forEach(function (d) {
                name2scenes[d.id] = []
                d.appearances.forEach(function (app) {
                    name2scenes[d.id].push(app.scene.start - 1)
                })
            })

            var name2paths = {}
            new_paths.forEach(function (path) {
                var name = path['id'].split('-')[0]
                if (!(name in name2paths)) {
                    name2paths[name] = [];
                }
                name2paths[name].push(path['id'])
            })

            var pathid2color = {}
            var isCSCpath = {}

            svg.selectAll("path").remove()
            // sort to draw transparent paths first
            var paths = svg.selectAll("path").data(new_paths.sort(function (x, y) { return x['stroke-opacity'] - y['stroke-opacity'] })).enter()
                .append("path")
                .attr("class", "link light")
                .style("cursor", "pointer")
                .attr("id", function (d) {
                    if (d['stroke-opacity'] == 1.0) {
                        pathid2color[d['id']] = d['stroke']
                    } else {
                        pathid2color[d['id']] = '#e0e0e0'
                    }
                    return d['id']
                })
                .attr("d", function (d) { return d['d'] })
                // .style("stroke-opacity", function (d) { return d['stroke-opacity'] })
                .style("stroke-opacity", 1.0)
                // .style("stroke", function (d) { return d['stroke'] })
                .style("stroke", function (d) {
                    if (d['stroke-opacity'] == 1.0) {
                        isCSCpath[d['id']] = true;
                        return d['stroke']
                    } else {
                        isCSCpath[d['id']] = false;
                        return '#e0e0e0'
                    }
                })
            // draw invisible paths (for clicking over)
            new_paths.forEach(function (d) {
                svg.append("path")
                    .attr("class", "link light")
                    .attr("id", d['id'] + '-removable')
                    .attr("d", d['d'])
                    .style("stroke", codeColors[name2code[d['id'].split('-')[0]]])
                    .style("visibility", "hidden")
            })

            var min_xt = width;
            var max_xt = 0;
            var max_y = 0;
            new_paths.filter(function (path) { return path['stroke-opacity'] == opacity2 }).forEach(function (path) {
                var xt0 = parseFloat(path['d'].split(' ')[2].split(',')[0])
                var xt1 = parseFloat(path['d'].split(' ')[3].split(',')[0])
                var y = parseFloat(path['d'].split(' ')[2].split(',')[1])

                min_xt = Math.min(min_xt, xt0)
                max_xt = Math.max(max_xt, xt1)
                max_y = Math.max(max_y, y)
            })
            svg.append("line")
                .attr("id", "baseline-line")
                .attr("x1", min_xt)
                .attr("y1", max_y)
                .attr("x2", max_xt)
                .attr("y2", max_y)
                .attr("stroke", "#e0e0e0")
                .attr("stroke-width", 4)

            // Draw the scenes
            svg.selectAll('.scene').data(narrative.scenes()).enter()
                .append('g').attr('class', 'scene')
                .attr('transform', function (d) {
                    var x, y;
                    x = Math.round(d.x) + 0.5;
                    y = Math.round(d.y) + 0.5;
                    return 'translate(' + [x, y] + ')';
                })

            var circleid2color = {}

            var name2circles = {}
            var scene2circles = {}
            // Draw appearances
            svg.selectAll('.scene').selectAll('.appearance').data(function (d) {
                return d.appearances;
            }).enter().append('circle')
                .attr("id", function (d, i) {
                    var scene_id = d.scene.start;
                    if (!(scene_id in scene2circles)) {
                        scene2circles[scene_id] = [];
                    }
                    scene2circles[scene_id].push('circle-' + scene_id + '-' + i)

                    var name = d.character.id.split(" ").join("_")
                    if (!(name in name2circles)) {
                        name2circles[name] = [];
                    }
                    name2circles[name].push("circle-" + scene_id + "-" + i)
                    circleid2color["circle-" + scene_id + "-" + i] = codeColors[d.character.code]
                    return "circle-" + scene_id + '-' + i
                })
                .attr('cx', function (d) {
                    return d.x;
                })
                .attr('cy', function (d) {
                    return d.y;
                })
                .attr('r', function () {
                    return 5;
                })
                .attr("fill", function (d) {
                    return codeColors[d.character.code];
                })
                .attr("stroke", function (d) {
                    return "white";
                })
                .attr("stroke-width", function () {
                    return 1.8
                })
                .attr('class', function (d) {
                    return 'appearance ' + d.character.affiliation;
                })
                .on("mouseover", function (d) {
                    // set opacity, if nothing is clicked
                    if (!(clickedChar | clickedScene)) {
                        var path_ids = name2paths[d.character.id.split(" ").join("_")]
                        path_ids.forEach(function (d) {
                            var opac = d3.select("#" + d).style("stroke-opacity")
                            if (opac == opacity1) {
                                d3.select("#" + d).style("stroke-opacity", opacity1 * opacity_change)
                            } else {
                                d3.select("#" + d).style("stroke-opacity", opacity2 * opacity_change)
                            }
                        })
                        opac = d3.select(this).style("fill-opacity")
                        if (opac == opacity1) {
                            d3.select(this).style("fill-opacity", opacity1 * opacity_change)
                        } else {
                            d3.select(this).style("fill-opacity", opacity2 * opacity_change)
                        }
                    }
                })
                .on("mouseout", function (d) {
                    if (!(clickedChar | clickedScene)) {
                        var path_ids = name2paths[d.character.id.split(" ").join("_")]
                        path_ids.forEach(function (d) {
                            var opac = d3.select("#" + d).style("stroke-opacity")
                            if (opac == opacity1 * opacity_change) {
                                d3.select("#" + d).style("stroke-opacity", opacity1)
                            } else {
                                d3.select("#" + d).style("stroke-opacity", opacity2)
                            }
                        })
                        opac = d3.select(this).style("fill-opacity")
                        if (opac == opacity1 * opacity_change) {
                            d3.select(this).style("fill-opacity", opacity1)
                        } else {
                            d3.select(this).style("fill-opacity", opacity2)
                        }
                    }
                })
                .on("click", function (d) {
                    clickCharacterID(d.character.id.split(" ").join("_"))
                })

            // Draw intro nodes
            svg.selectAll('.intro').data(narrative.introductions())
                .enter().call(function (s) {
                    var g, text;

                    g = s.append('g').attr('class', 'intro');

                    text = g.append('g').attr('class', 'text');

                    // Apppend two actual 'text' nodes to fake an 'outside' outline.
                    text.append('text');
                    text.append('text').attr('class', 'color');

                    g.attr('transform', function (d) {
                        var x, y;
                        x = Math.round(d.x);
                        y = Math.round(d.y);
                        return 'translate(' + [x, y] + ')';
                    });

                    g.selectAll('text')
                        .attr('text-anchor', 'end')
                        .attr('y', '4px')
                        .attr('x', '-10px')
                        .attr("id", function (d) { return d.character.name.split(' ').join('_') })
                        .text(function (d) { return d.character.name; });

                    g.select('.color')
                        .attr('class', function (d) {
                            return 'color ' + d.character.affiliation;
                        });

                    g.select('rect')
                        .attr('class', function (d) {
                            return d.character.affiliation;
                        });

                });

            // DRAW HEADER
            header = d3.select("#narrative-1").append('svg')
                .attr('id', 'liheader')
                .attr('width', width + 180)
                .attr('height', headerShift);

            // header index
            header.selectAll('text')
                .data(scenes).enter()
                .append('text')
                .attr("x", function (d) {
                    return d.x + labelSize[1] + 24
                })
                .attr("y", (headerShift - 24) + "px")
                .text(function (d, i) {
                    return response.scenenames[i]
                })
                .style("text-anchor", "middle")
                .style("dominant-baseline", "middle")
                .style("font-family", "TheMATTER")
                .style("font-weight", "bold")
                .style("font-size", 10)
                .on("mouseover", function (d) {
                    if (!(clickedChar | clickedScene)) {
                        scene2circles[d.start].forEach(function (k) {
                            var node = d3.select("#" + k)
                            node.style("stroke-opacity", 0.6)
                            // node.style("fill", coreColors[response.cores[d.start-1]])
                        })
                    }
                })
                .on("mouseout", function (d) {
                    if (!(clickedChar | clickedScene)) {
                        scene2circles[d.start].forEach(function (k) {
                            var node = d3.select("#" + k)
                            node.style("stroke-opacity", 1.0)
                            // node.style("fill", codeColors[d.character.code])
                        })
                    }
                })

            // header see-all button
            var button_width = 93;
            var button_height = 38;
            var button_g = header.append("g")
            var seeall_active = true;
            var seeall = button_g.append("rect")
                .attr("id", "liseeall")
                .attr("width", button_width)
                .attr("height", button_height)
                .style("fill", "#e0e0e0")
                .style("stroke", "white")
                .style("border", "none")
                .style("outline", "none")
                .attr("rx", 4)
                .attr("ry", 4)
                .attr("x", 30)
                .attr("y", 30)
            button_g.append("text")
                .attr("x", button_width / 2 + 30)
                .attr("y", button_height / 2 + 30)
                .attr("text-anchor", "middle")
                .style("dominant-baseline", "middle")
                .text("ดูทั้งหมด")
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .style("fill", "white")

            seeall.on("mouseover", function () {
                if (seeall_active) {
                    d3.select(this).style("fill-opacity", 0.8)
                }
            }).on("mouseout", function () {
                if (seeall_active) {
                    d3.select(this).style("fill-opacity", 1.0)
                }
            })
            seeall.on("click", function () {
                // do shit when button is clicked
                clickSeeAll()
            })

            // header bars
            var header_colors = {}
            for (var si = 53; si < 63; si++) {
                var subscenes = scenes.filter(function (d, i) {
                    return parseInt(response.scenenames[i].split(".")[0]) == si
                })
                var scene_color = coreColors[response.cores.filter(function (d, i) {
                    return parseInt(response.scenenames[i].split(".")[0]) == si
                })[0]]
                // calculate extent
                var scene_x0 = subscenes[0].x + labelSize[1] - 0;
                var scene_x1 = subscenes.slice(-1)[0].x + labelSize[1] + 72;
                var header_g = header.append("g")
                var header_y = 72;

                var rect = header_g.append("rect")
                    .attr("id", "liheader-rect-" + si)
                    .attr("x", scene_x0)
                    .attr("y", header_y)
                    .attr("height", 37)
                    .attr("width", scene_x1 - scene_x0)
                    .style("fill", "white")
                    .style("rx", 5)
                    .style("ry", 5)
                    .style("stroke-width", 2)
                    .style("stroke", scene_color)
                    .style("cursor", "pointer")

                header_g.append("svg:image")
                    .attr("xlink:href", "icons/" + si + ".png")
                    .attr("height", "21px")
                    .attr("x", (scene_x0 + scene_x1) / 2 - 24)
                    .attr("y", header_y + 37 / 2 - 10.5)

                header_g.append("text")
                    .text("No. " + si)
                    .style("font-family", "TheMATTER")
                    .style("font-weight", "bold")
                    .style("font-size", 16)
                    .attr("x", (scene_x0 + scene_x1) / 2 + 20)
                    .attr("y", header_y + 37 / 2 + 2)
                    .style("text-anchor", "middle")
                    .style("dominant-baseline", "middle")

                header_colors[si] = scene_color

                rect.on("mouseover", function () {
                    if (!(clickedChar | clickedScene)) {
                        var bar = d3.select(this)
                        bar.style("fill", header_colors[bar.attr("id").split("-")[2]])
                        bar.style("stroke", "white")
                    }
                })
                    .on("mouseout", function () {
                        if (!(clickedChar | clickedScene)) {
                            var bar = d3.select(this)
                            bar.style("fill", "white")
                            bar.style("stroke", header_colors[bar.attr("id").split("-")[2]])
                        }
                    })
                    .on("click", function () {
                        clickHeaderBar(d3.select(this).attr("id").split("-")[2])
                    })
            }

            var all_path_ids = [];
            var all_circle_ids = [];
            Object.values(name2paths).forEach(function (ps) {
                ps.forEach(function (path_id) {
                    all_path_ids.push(path_id)
                })
            })
            Object.values(name2circles).forEach(function (cs) {
                cs.forEach(function (circle_id) {
                    all_circle_ids.push(circle_id)
                })
            })
            paths.on("click", function (d) {
                clickCharacterID(d['id'].split('-')[0])
            })

            // add tooltip for paths
            var tooltip_g = svg.append("g")
                .attr("id", "tooltip_g")
                .style("visibility", "hidden")
            var tooltip = tooltip_g.append("rect")
                .attr("id", "tooltip_rect")
                .attr("width", 92)
                .attr("height", 24)
                .attr("rx", 3)
                .attr("ry", 3)
                .attr("x", 1000)
                .attr("y", 500)
                .style("fill", "white")
            var tooltip_text = tooltip_g.append("text")
                .attr("id", "tooltip_text")
                .attr("x", 1000 + 92 / 2)
                .attr("y", 500 + 24 / 2)
                .attr("text-anchor", "middle")
                .attr("dominant-baseline", "middle")
                .style("font-family", "NotoSans")
                .style("font-size", 12)

            // mouseover on tooltip & other shit
            paths.on("mouseover", function (d) {
                // set opacity if nothing is clicked
                if (!(clickedChar | clickedScene)) {
                    var path_ids = name2paths[d['id'].split('-')[0]]
                    path_ids.forEach(function (d) {
                        var opac = d3.select("#" + d).style("stroke-opacity")
                        if (opac == opacity1) {
                            d3.select("#" + d).style("stroke-opacity", opacity1 * opacity_change)
                        } else {
                            d3.select("#" + d).style("stroke-opacity", opacity2 * opacity_change)
                        }
                    })
                    var circle_ids = name2circles[d['id'].split('-')[0]]
                    circle_ids.forEach(function (c) {
                        var circle = d3.select("#" + c)
                        var opac = circle.style("fill-opacity")
                        if (opac == opacity1) {
                            d3.select("#" + c).style("fill-opacity", opacity1 * opacity_change)
                        } else {
                            d3.select("#" + c).style("fill-opacity", opacity2 * opacity_change)
                        }
                    })
                }
                // tooltip
                var name = d['id'].split('-')[0].split('_').join(' ')
                d3.select("#tooltip_g").style("visibility", "visible")
                d3.select("#tooltip_text").text(name)
                var textwidth = d3.select("#tooltip_text").node().getBoundingClientRect().width
                d3.select("#tooltip_rect").attr("width", textwidth + 12)
            }).on("mousemove", function (d) {
                // tooltip
                var name = d['id'].split('-')[0].split('_').join(' ')
                // change position & text
                var boxwidth = d3.select("#tooltip_rect").attr("width")
                d3.select("#tooltip_text")
                    .text(name)
                    .attr("x", d3.mouse(this)[0] + boxwidth / 2)
                    .attr("y", d3.mouse(this)[1] + 24 / 2 - 24 - 6)
                d3.select("#tooltip_rect")
                    .attr("x", d3.mouse(this)[0])
                    .attr("y", d3.mouse(this)[1] - 24 - 6)
            })
                .on("mouseout", function (d) {
                    // set opacity if nothing is clicked
                    if (!(clickedChar | clickedScene)) {
                        var path_ids = name2paths[d['id'].split('-')[0]]
                        path_ids.forEach(function (d) {
                            var opac = d3.select("#" + d).style("stroke-opacity")
                            if (opac == opacity1 * opacity_change) {
                                d3.select("#" + d).style("stroke-opacity", opacity1)
                            } else {
                                d3.select("#" + d).style("stroke-opacity", opacity2)
                            }
                        })
                        var circle_ids = name2circles[d['id'].split('-')[0]]
                        circle_ids.forEach(function (c) {
                            var circle = d3.select("#" + c)
                            var opac = circle.style("fill-opacity")
                            if (opac == opacity1 * opacity_change) {
                                d3.select("#" + c).style("fill-opacity", opacity1)
                            } else {
                                d3.select("#" + c).style("fill-opacity", opacity2)
                            }
                        })
                    }
                    // tooltip
                    d3.select("#tooltip_g").style("visibility", "hidden")
                })

            // do shit once seeall is clicked
            // sets all circles and paths to proper colors
            function clickSeeAll() {
                // deactivate all shit
                clickedChar = false;
                clickedScene = false;
                seeall_active = false;
                all_path_ids.forEach(function (path_id) {
                    var color = pathid2color[path_id]
                    d3.select("#" + path_id).style("stroke", color)
                    d3.select("#" + path_id + "-removable").style("visibility", "hidden")
                })
                all_circle_ids.forEach(function (circle_id) {
                    var color = circleid2color[circle_id]
                    d3.select("#" + circle_id).style("fill", color)
                })
                for (var i = 53; i < 63; i++) {
                    d3.select("#liheader-rect-" + i).style("fill", "white")
                    d3.select("#liheader-rect-" + i).style("stroke", header_colors[i])
                }
                d3.select("#baseline-line").style("visibility", "visible")
                d3.select("#liseeall").style("fill", "#e0e0e0")
                d3.select("#li-charcard").style("visibility", "hidden")
                d3.select("#li-scenecard").style("visibility", "hidden")
                d3.select("#li-charcard-b1").style("visibility", "hidden")
                var card = document.getElementById("narrative-1-card")
                card.style.maxHeight = null;
                card.style.height = null;
            }

            // do shit once seeall is activated
            function activateSeeAll() {
                seeall_active = true;
                d3.select("#liseeall").style("fill", "black")
            }

            // do shit once character line/circle is clicked on
            // sets a shit ton of colors to gray
            function clickCharacterID(name) {

                clickedChar = true;
                activateSeeAll()

                var path_ids = name2paths[name]
                var circle_ids = name2circles[name]

                // get path ids & circle ids to set to gray
                var other_paths = all_path_ids.filter(function (p) {
                    return !path_ids.includes(p)
                })
                var other_circles = all_circle_ids.filter(function (c) {
                    return !circle_ids.includes(c)
                })

                // set circles to fill
                circle_ids.forEach(function (circle_id) {
                    var color = codeColors[name2code[circle_id.split('-')[0]]]
                    d3.select("#" + circle_id).style("fill", color)
                    d3.select("#" + circle_id).style("fill-opacity", 1.0)
                })
                // set other paths to gray
                other_paths.forEach(function (path_id) {
                    d3.select("#" + path_id).style("stroke", "#e0e0e0")
                    d3.select("#" + path_id + "-removable").style("visibility", "hidden")
                })
                // set other circles to gray
                other_circles.forEach(function (circle_id) {
                    d3.select("#" + circle_id).style("fill", "#e0e0e0")
                    d3.select("#" + circle_id).style("fill-opacity", 1.0)
                })
                // set all character paths to fill
                path_ids.forEach(function (path_id) {
                    d3.select("#" + path_id + "-removable").style("visibility", "visible")
                    d3.select("#" + path_id).style("stroke-opacity", 1.0)
                })
                // remove baseline
                d3.select("#baseline-line").style("visibility", "hidden")
                // set all headers to normal
                for (var i = 53; i < 63; i++) {
                    d3.select("#liheader-rect-" + i).style("fill", "white")
                    d3.select("#liheader-rect-" + i).style("stroke", header_colors[i])
                }

                // set li-scenecard to hidden
                d3.select("#li-scenecard").style("visibility", "hidden")
                d3.select("#li-charcard").style("border-color", codeColors[name2code[name]])
                var cc_name = d3.select("#li-charcard-name")
                cc_name.text(name.split("_").join(" "))
                d3.select("#li-charcard").style("visibility", "visible")
                d3.select("#li-charcard-b1").style("visibility", "hidden")
                if (response.twfu.includes(name.split('_').join(' '))) {
                    d3.select("#li-charcard-b1").attr("href", "https://theyworkforus.elect.in.th/people/" + name.split('_').join('-'))
                    d3.select("#li-charcard-b1").style("visibility", "visible")
                }
                d3.select("#li-charcard-t2").text(response.person_profile[name.split("_").join(" ")])
                d3.select("#li-charcard-img").attr("src", "page/src/assets/images/politician-photos-crop/" + response.name2file[name.split("_").join("-")])
                var h = d3.select("#li-charcard-t2").node().getBoundingClientRect().height
                d3.select("#li-charcard").style("height", parseInt(Math.max(350, 50 + h + 50)) + "px")
                // set li-li-charcard-expand props
                var ns = name2scenes[name.split("_").join(" ")]
                var n_cabinets = new Set(ns.map(d => response.scenenames[d].split('.')[0])).size
                d3.select("#li-charcard-expand-title").text("จำนวนครม. " + n_cabinets + " ชุด")

                // set expand content
                var charsvg = d3.select("#li-charcard-expand-content-svg")
                var grad_height = 200;
                var delta_line = 10;
                var delta_text = 30;
                charsvg.attr("height", grad_height + "px")
                charsvg.html('')
                // draw see more if needed
                var total_y = n_cabinets * delta_line + ns.length * delta_text
                if (total_y > grad_height) {
                    var grad = charsvg.append("defs")
                        .append("linearGradient")
                        .attr("id", "li-charcard-gradient")
                        .attr("x1", 0)
                        .attr("x2", 0)
                        .attr("y1", 0)
                        .attr("y2", 1)
                    grad.append("stop")
                        .attr("class", "stop1")
                        .attr("offset", "0%")
                        .attr("stop-color", "white")
                    grad.append("stop")
                        .attr("class", "stop2")
                        .attr("offset", "100%")
                        .attr("stop-color", "#e0e0e0")
                    charsvg.append("rect")
                        .attr("id", "li-charcard-grad-rect")
                        .attr("width", "100%")
                        .attr("height", "100%")
                        .style("stroke", "none")
                        .style("fill", "url(#li-charcard-gradient)")
                }

                // draw other elements
                var last_c = ''
                var cy = 0;
                ns.forEach(function (n) {
                    var si = response.scenenames[n]
                    if (si.split(".")[0] !== last_c) {
                        cy += delta_line
                        charsvg.append("rect")
                            .attr("width", "100%")
                            .attr("height", "4px")
                            .style("stroke", header_colors[parseInt(si.split(".")[0])])
                            .style("fill", header_colors[parseInt(si.split(".")[0])])
                            .attr("y", cy)
                    }
                    var text = response.name2pos[name.split('_').join(' ')][si].join(', ')
                    cy += delta_text
                    charsvg.append("text")
                        .attr("class", "li-charcard-expand-content-text")
                        .attr("width", "20%")
                        .attr("height", delta_text + "px")
                        .attr("y", cy)
                        .html(si)
                        .style("font-weight", "bold")
                    var text_element = charsvg.append("text")
                        .attr("class", "li-charcard-expand-content-text")
                        .attr("width", "80%")
                        .attr("height", delta_text + "px")
                        .attr("y", cy)
                        .attr("x", "14%")
                        .html(text)
                    if (text_element.node().getComputedTextLength() > 275) {
                        var lim = 1;
                        for (var lim = 1; lim <= text.split(", ").length; lim++) {
                            text_element.html(text.split(", ").slice(0, lim).join(", "))
                            if (text_element.node().getComputedTextLength() > 275) {
                                break
                            }
                        }
                        // slice at lim
                        text_element.html(text.split(", ").slice(0, lim-1).join(", ") + ",")
                        cy += 24
                        charsvg.append("text")
                            .attr("class", "li-charcard-expand-content-text")
                            .attr("width", "80%")
                            .attr("height", delta_text + "px")
                            .attr("y", cy)
                            .attr("x", "14%")
                            .html(text.split(", ").slice(lim-1).join(", "))
                    }
                    last_c = si.split(".")[0]
                })

                // draw see more if needed
                total_y = cy;
                if (total_y > grad_height) {
                    charsvg.append("rect")
                        .attr("id", "li-charcard-seemore1")
                        .attr("width", "83px")
                        .attr("height", "34px")
                        .attr("text", "ดูทั้งหมด")
                        .attr("x", "calc(50% - 42px)")
                        .attr("y", grad_height - 24 - 24)
                        .style("position", "absolute")
                        .style("fill", "white")
                        .style("rx", 5)
                        .style("ry", 5)
                        .style("stroke", "black")
                    charsvg.append("text")
                        .attr("id", "li-charcard-seemore2")
                        .text("ดูทั้งหมด")
                        .style("font-size", "12px")
                        .style("font-family", "NotoSans")
                        .attr("x", "50%")
                        .attr("y", grad_height - 24 - 4)
                        .attr("line-height", "120%")
                        .style("position", "absolute")
                        .attr("text-anchor", "middle")
                    charsvg.append("rect")
                        .attr("id", "li-charcard-seemore3")
                        .attr("width", "83px")
                        .attr("height", "34px")
                        .attr("x", "calc(50% - 42px)")
                        .attr("y", grad_height - 24 - 24)
                        .style("position", "absolute")
                        .style("fill", "transparent")
                        .style("outline", "none")
                        .style("rx", 5)
                        .style("ry", 5)
                        .style("cursor", "pointer")
                        .on("mouseover", function () {
                            d3.select("#li-charcard-seemore1").style("fill", "#f8f8f8")
                        })
                        .on("mouseout", function () {
                            d3.select("#li-charcard-seemore1").style("fill", "white")
                        })
                        .on("click", function () {
                            // expand box & remove shit
                            d3.select("#li-charcard-grad-rect").style("fill", "white")
                                .attr("height", total_y + 4)
                            d3.select("#li-charcard-expand-content-svg").attr("height", total_y + 4)
                            d3.select("#li-charcard").style("height", (100 + total_y + 50) + "px")
                            d3.select("#li-charcard-seemore1").remove()
                            d3.select("#li-charcard-seemore2").remove()
                            d3.select("#li-charcard-seemore3").remove()
                            setNarrativeCardHeight()
                        })
                }
                setNarrativeCardHeight()
            }

            function setNarrativeCardHeight() {
                var card = document.getElementById("narrative-1-card")
                var charcard = document.getElementById("li-charcard").clientHeight
                var scenecard = document.getElementById("li-scenecard").clientHeight
                var newh = (Math.max(charcard, scenecard) + 60) + "px"
                card.style.maxHeight = newh
                card.style.height = newh
            }

            // do shit once header bar is clicked on
            // sets a ton of shit to gray
            function clickHeaderBar(scene_id) {

                clickedScene = true;
                activateSeeAll()

                var circles = [];
                for (var i = 0; i < scenes.length; i++) {
                    if (response.scenenames[i].split(".")[0] == scene_id) {
                        circles.push(...scene2circles[i + 1])
                    }
                }
                var other_circles = all_circle_ids.filter(function (circle_id) {
                    return !(circles.includes(circle_id))
                })

                // set own circles to fill
                circles.forEach(function (circle_id) {
                    d3.select("#" + circle_id).style("fill", circleid2color[circle_id])
                })
                // set other circles to gray
                other_circles.forEach(function (circle_id) {
                    d3.select("#" + circle_id).style("fill", "#e0e0e0")
                })
                // set all paths to gray
                all_path_ids.forEach(function (path_id) {
                    d3.select("#" + path_id).style("stroke", "#e0e0e0")
                    d3.select("#" + path_id + "-removable").style("visibility", "hidden")
                })
                // set other (all) headers to white
                for (var i = 53; i < 63; i++) {
                    d3.select("#liheader-rect-" + i).style("fill", "white")
                    d3.select("#liheader-rect-" + i).style("stroke", header_colors[i])
                }
                // set header to fill color
                d3.select("#liheader-rect-" + scene_id).style("fill", header_colors[scene_id])
                d3.select("#liheader-rect-" + scene_id).style("stroke", "white")

                // set li-charcard to hidden
                d3.select("#li-charcard").style("visibility", "hidden")
                d3.select("#li-scenecard").style("border-color", header_colors[scene_id])
                var sc_name = d3.select("#li-scenecard-name")
                sc_name.text("คณะรัฐมนตรี ชุดที่ " + scene_id)
                d3.select("#li-scenecard-img").attr("src", "page/src/assets/images/politician-photos-crop/" + response.name2file[response.scene2pm[parseInt(scene_id)].split(' ').join('-')])
                d3.select("#li-scenecard").style("visibility", "visible")
                d3.select("#li-scenecard-t1").html('<span style="font-weight: bold;"> นายกรัฐมนตรี </span> ' + response.scene2pm[parseInt(scene_id)])
                d3.select("#li-scenecard-t2").text(response.cabinet_profile[scene_id])
                var h = d3.select("#li-scenecard-t2").node().getBoundingClientRect().height
                d3.select("#li-scenecard").style("height", parseInt(Math.max(350, 50 + h + 50)) + "px")

                // add options for accordion, first clear out
                var acc = d3.select("#li-scenecard-ac")
                acc.node().innerHTML = ''
                var ns = response.scenenames.filter(d => parseInt(d.split(".")[0]) == scene_id)
                ns.forEach(function (n) {
                    acc.append("button")
                        .attr("class", "li-scenecard-ac-button")
                        .text("รายชื่อชุดที่ " + n)
                    var scene_html = '<p></p>';
                    response.scene2pos[scene_id].forEach(function (d) {
                        scene_html += '<b>' + d.pos + '</b><p></p>'
                        scene_html += d.names.join('<br>')
                        scene_html += '<p></p>'
                    })
                    scene_html = scene_html.slice(0, -7)
                    acc.append("div")
                        .attr("class", "li-scenecard-ac-panel")
                        .html(scene_html)
                })
                // set activation for accordion buttons
                var buttons = document.getElementsByClassName("li-scenecard-ac-button")
                for (var i = 0; i < buttons.length; i++) {
                    buttons[i].addEventListener("click", function () {
                        this.classList.toggle("active")
                        var panel = this.nextElementSibling
                        var nh = document.getElementById("li-scenecard-ac").getBoundingClientRect().height
                        if (panel.style.maxHeight) {
                            panel.style.maxHeight = null;
                            nh -= panel.scrollHeight
                        } else {
                            panel.style.maxHeight = panel.scrollHeight + "px"
                            nh += panel.scrollHeight
                        }
                        var t2h = d3.select("#li-scenecard-t2").node().getBoundingClientRect().height
                        var rh = parseInt(Math.max(350, Math.max(50 + t2h + 50, 50 + nh + 50)))
                        // d3.select("#li-scenecard").node().style.maxHeight = rh
                        d3.select("#li-scenecard").style("height", rh + "px")
                        setNarrativeCardHeight()
                    })
                }

                setNarrativeCardHeight()
            }

            var max_x = 0;
            scenes.forEach(function (scene) {
                max_x = Math.max(max_x, scene.x)
            })
            svg.attr("width", max_x + 180)

        });

        function wrangle(data) {

            var charactersMap = {};

            return data.scenes.map(function (scene) {
                return {
                    characters: scene.map(function (id) {
                        return characterById(id);
                    }).filter(function (d) { return (d); })
                };
            });

            // Helper to get characters by ID from the raw data
            function characterById(id) {
                charactersMap = charactersMap || {};
                charactersMap[id] = charactersMap[id] || data.characters.find(function (character) {
                    return character.id === id;
                });
                return charactersMap[id];
            }

        }

    </script>

    <!-- triangle narrative -->

    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script>
        d3.json('temp.json', function (err, response) {

            var showCores = true;

            var codeColors = {
                '100': '#00ab7c', // ทหาร
                '010': '#ff0017', // ทักษิณ
                '001': '#36bed9', // ปชป
                '110': '#923e1b', // ทหาร + ทักษิณ
                '101': '#358295', // ทหาร + ปชป
                '011': '#7168ca', // ทักษิณ + ปชป
                '111': '#000000' // ทหาร + ทักษิณ + ปชป
            }

            var coreColors = {
                'army': '#00ab7c',
                'thaksin': '#ff0017',
                'democrat': '#36bed9'
            }

            var width = 900;
            var height = 800;
            var clusterSize = 100;
            var clusterPadding = 2;
            var TriHeight = 553;
            var TriWidth = 645;

            // create svg, required mapping objects
            var svg = d3.select("#narrative-2-svg").append("svg")
                .style("display", "block")
                .attr("width", width + "px")
                .attr("height", height + "px")

            var leftOffset = (width - TriWidth) / 2;
            var topOffset = 90;

            var centroid_x = ((TriWidth / 2 + leftOffset) + (TriWidth + leftOffset) + (leftOffset)) / 3
            var centroid_y = ((topOffset) + (TriHeight + topOffset) + (TriHeight + topOffset)) / 3
            var stroke_color = "#888888"
            var stroke_width = 3
            var stroke_dash = 6

            svg.append("image")
                .attr("xlink:href", "core_green.png")
                .style("position", "absolute")
                .attr("width", "54px")
                .attr("x", leftOffset - 81)
                .attr("y", 639)
            svg.append("image")
                .attr("xlink:href", "core_red.png")
                .style("position", "absolute")
                .attr("width", "98px")
                .attr("x", leftOffset + 659)
                .attr("y", 641)
            svg.append("image")
                .attr("xlink:href", "core_blue.png")
                .style("position", "absolute")
                .attr("width", "98px")
                .attr("x", leftOffset + 274)
                .attr("y", 27)
            svg.append("image")
                .attr("xlink:href", "triangle.svg")
                .attr("id", "tr-overlay-triangle")
                .style("position", "absolute")
                .attr("width", TriWidth)
                .attr("height", TriHeight)
                .attr("x", leftOffset - 0.3)
                .attr("y", topOffset - 0.3)
                .style("opacity", 0.8)

            svg.append("defs")
                .append("marker")
                .attr("id", "tr-arrowhead")
                .attr("markerWidth", 7)
                .attr("markerHeight", 4)
                .attr("refX", 0)
                .attr("refY", 2)
                .attr("orient", "auto")
                .append("polygon")
                .attr("points", "0 0, 7 2, 0 4")
            svg.append("line")
                .attr("x1", leftOffset + 269 - 0.3)
                .attr("y1", 145)
                .attr("x2", leftOffset + 299 - 0.3)
                .attr("y2", 95)
                .style("stroke", "black")
                .style("stroke-width", 1.5)
                .style("marker-end", "url(#tr-arrowhead)")
            svg.append("line")
                .attr("x1", leftOffset + 377 - 0.3)
                .attr("y1", 145)
                .attr("x2", leftOffset + 347 - 0.3)
                .attr("y2", 95)
                .style("stroke", "black")
                .style("stroke-width", 1.5)
                .style("marker-end", "url(#tr-arrowhead)")
            svg.append("line")
                .attr("x1", leftOffset + 630 - 0.3)
                .attr("y1", 574)
                .attr("x2", leftOffset + 659 - 0.3)
                .attr("y2", 624)
                .style("stroke", "black")
                .style("stroke-width", 1.5)
                .style("marker-end", "url(#tr-arrowhead)")
            svg.append("line")
                .attr("x1", leftOffset + 578 - 0.3)
                .attr("y1", 661)
                .attr("x2", leftOffset + 637 - 0.3)
                .attr("y2", 661)
                .style("stroke", "black")
                .style("stroke-width", 1.5)
                .style("marker-end", "url(#tr-arrowhead)")
            svg.append("line")
                .attr("x1", leftOffset + 71 - 0.3)
                .attr("y1", 661)
                .attr("x2", leftOffset + 12 - 0.3)
                .attr("y2", 661)
                .style("stroke", "black")
                .style("stroke-width", 1.5)
                .style("marker-end", "url(#tr-arrowhead)")
            svg.append("line")
                .attr("x1", leftOffset + 18 - 0.3)
                .attr("y1", 574)
                .attr("x2", leftOffset - 11 - 0.3)
                .attr("y2", 624)
                .style("stroke", "black")
                .style("stroke-width", 1.5)
                .style("marker-end", "url(#tr-arrowhead)")

            var scene_ids = new Set([]);
            var animate_data = {};
            var scene2apps = {}; // maps scene -> person -> app
            var firstapps = {}; // maps person -> 1st app
            response.forEach(function (d) {
                var scene_id = d.scene.split("_")[0]
                scene_ids.add(scene_id)
                d.points.forEach(function (point) {
                    if (!(point.data.name in animate_data)) {
                        animate_data[point.data.name] = {}
                    }
                    animate_data[point.data.name][scene_id] = {
                        cx: point.cx + 0.02*(centroid_x - point.cx),
                        cy: point.cy + 0.02*(centroid_y - point.cy),
                        value: point.data.value * 2.0,
                        name: point.data.name,
                        color: codeColors[point.data.code]
                    }
                })

                // map scene -> person -> app
                if (!(scene_id in scene2apps)) {
                    scene2apps[scene_id] = {}
                }
                d.points.forEach(function (d) {
                    scene2apps[scene_id][d.data.name] = animate_data[d.data.name][scene_id]
                    // 1st apps
                    if (!(d.data.name in firstapps)) {
                        firstapps[d.data.name] = animate_data[d.data.name][scene_id]
                    }
                })
            })
            scene_ids = Array.from(scene_ids).sort()

            // activate animations on scroll
            $(window).scroll(function () {
                if ($(window).scrollTop() >= 7000) {
                    startAnimation()
                }
            })
            // OR on load
            function checkLoad() {
                if ($(window).scrollTop() >= 7000) {
                    startAnimation()
                }
            }

            // animations
            var current_val = 53;
            var in_animation = true;
            var animation_started = false;
            function endAnimation() {
                in_animation = false;
            }

            // slider bar
            var slider = svg.append("g")
                .attr("class", "tr-slider")
                .attr("transform", "translate(" + (leftOffset + 22) + ",725)");

            var _range = [53, 54, 55, 56, 57, 58, 59, 60, 61, 62]
            var slideLength = 577;

            var slider_ticks = slider.append("g")
                .attr("class", "ticks")

            slider_ticks.selectAll("text")
                .data(_range)
                .enter()
                .append("text")
                .attr("x", d => (d - 53) * (slideLength / 9.0) + 5)
                .attr("y", 28)
                .style("fill", "#828282")
                .style("font-size", "12px")
                .style("font-family", "NotoSans, NotoSansEng")
                .text(function (d) { return d });

            _range.forEach(function (d) {
                slider.append("line")
                    .attr("x1", (d - 53) * (slideLength / 9.0))
                    .attr("x2", (d - 53) * (slideLength / 9.0))
                    .attr("y1", 9)
                    .attr("y2", 29)
                    .style("stroke", "#e0e0e0")
                    .style("stroke-width", 2)
            })

            slider.append("line")
                .attr("class", "tr-track")
                .attr("x1", 0)
                .attr("x2", slideLength)
                .select(function () { return this.parentNode.appendChild(this.cloneNode(true)); })
                .attr("class", "tr-track-inset")
                .select(function () { return this.parentNode.appendChild(this.cloneNode(true)); })
                .attr("class", "tr-track-overlay")
                .call(d3.drag()
                    .on("start.interrupt", function () { slider.interrupt(); })
                    .on("start drag", function () {
                        var val = d3.event.x / (slideLength / 9.0);
                        val = Math.max(0, Math.min(Math.round(val), 9))
                        update(val);
                    })
                );

            var handle = slider.insert("circle", ".track-overlay")
                .attr("class", "tr-handle")
                .attr("r", 16)

            var t_animate = 750;
            function startAnimation() {
                if (!(animation_started)) {
                    animation_started = true;
                    window.setTimeout(endAnimation, t_animate * 9 + 1000)
                    window.setTimeout(initMouseover, t_animate * 9 + 1000)
                    for (var i = 1; i <= 9; i++) {
                        handle.transition().delay(t_animate * i)
                            .duration(t_animate)
                            .attr("cx", i * (slideLength / 9))
                        current_val = 53 + i;
                    }

                    Object.keys(animate_data).forEach(function (name) {
                        var apps = animate_data[name]
                        var circle = svg.append("circle")
                            .attr("id", "tr-circle-" + name.split(" ").join("-"))
                            .style("visibility", "hidden")
                            .style("opacity", 0.0)
                        scene_ids.forEach(function (scene_id, i) {
                            if (scene_id in apps) {

                                d = apps[scene_id]
                                var dx = centroid_x - d['cx']
                                var dy = centroid_y - d['cy']
                                var dist = Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2))
                                if (d.color == codeColors['100']) {
                                    var cx = d['cx'] + dx * 0.02
                                    var cy = d['cy'] + dy * 0.02
                                    cy += 2.0
                                } else {
                                    var cx = d['cx'] + dx * 0.01
                                    var cy = d['cy'] + dy * 0.01
                                }
                                // normalize for scene
                                cx = (cx - 60) / 690 * TriWidth + leftOffset
                                cy = (cy - 60) / 590 * TriHeight + topOffset
                                d['cx'] = cx
                                d['cy'] = cy
                                var dur = t_animate;
                                circle.transition().delay(dur * i)
                                    .duration(dur)
                                    .attr("cx", cx)
                                    .attr("cy", cy)
                                    .attr("r", d['value'])
                                    .style("fill", d['color'])
                                    .style("visibility", "visible")
                                    .style("opacity", 1.0)
                            }

                        })
                    })
                }
            }

            function update(h) {
                if (!(in_animation) & current_val !== 53 + h) {
                    handle.attr("cx", h * (slideLength / 9));

                    // transition points
                    var old_points = scene2apps[current_val]
                    var new_points = scene2apps[(53 + h)]
                    Object.keys(old_points).forEach(function (name) {
                        if (name in new_points) { // only transition location
                            var pt = new_points[name]
                            d3.select("#tr-circle-" + name.split(" ").join("-"))
                                .transition().duration(t_animate)
                                .attr("cx", pt.cx)
                                .attr("cy", pt.cy)
                                .attr("r", pt.value)
                                .style("fill", pt.color)
                                .style("visibility", "visible")
                                .style("opacity", 1.0)
                        } else { // set visibility & opacity to 0
                            var pt = firstapps[name]
                            d3.select("#tr-circle-" + name.split(" ").join("-"))
                                .transition().duration(t_animate)
                                .attr("r", pt.value)
                                .style("fill", pt.color)
                                .style("visibility", "hidden")
                                .style("opacity", 0.0)
                        }
                    })
                    Object.keys(new_points).forEach(function (name) {
                        if (!(name in old_points)) { // set visibility & opacity to 1
                            var pt = new_points[name]
                            d3.select("#tr-circle-" + name.split(" ").join("-"))
                                .transition().duration(t_animate)
                                .attr("cx", pt.cx)
                                .attr("cy", pt.cy)
                                .attr("r", pt.value)
                                .style("fill", pt.color)
                                .style("visibility", "visible")
                                .style("opacity", 1.0)
                        }
                    })
                    current_val = 53 + h;
                    addMouseover(current_val)
                }
            }

            // circle mouseover
            var avatar_radius = 24;
            var avatar_yoff = 32;
            var defs = svg.append("defs")
            function addMouseover(scene_id) {

                Object.keys(animate_data).forEach(function (name) {
                    d3.select("#tr-circle-" + name.split(" ").join("-"))
                        .on("mouseover", function () { })
                        .on("mouseout", function () { })
                })

                var apps = scene2apps[scene_id]
                Object.keys(apps).forEach(function (name) {
                    var item = apps[name]
                    if (item.value > 2) {
                        var circle = d3.select("#tr-circle-" + name.split(" ").join("-"))
                        var avatar_yoff = avatar_radius + parseInt(circle.attr("r")) + 4
                        circle.on("mouseover", function () { // mouse over
                            // circle border
                            circle.style("stroke", "black")
                                .style("stroke-radius", 4)
                            // image avatar
                            defs.append("clipPath")
                                .attr("id", "tr-avatar-clip" + name.split(" ").join("-"))
                                .append("circle")
                                .attr("cx", item.cx)
                                .attr("cy", item.cy - avatar_yoff)
                                .attr("r", avatar_radius)
                            svg.append("circle")
                                .attr("id", "tr-image-avatar-bg")
                                .attr("cx", item.cx)
                                .attr("cy", item.cy - avatar_yoff)
                                .attr("r", avatar_radius + 2)
                                .attr("fill", "white")
                            svg.append("image")
                                .attr("xlink:href", "page/src/assets/images/politician-photos-crop/" + response[0].name2file[name.split(' ').join('-')])
                                .attr("id", "tr-image-avatar" + name.split(" ").join("-"))
                                .style("position", "absolute")
                                .attr("width", parseInt(avatar_radius * 2) + "px")
                                .attr("x", item.cx - avatar_radius)
                                .attr("y", item.cy - avatar_yoff - avatar_radius)
                                .attr("clip-path", "url(#tr-avatar-clip" + name.split(" ").join("-") + ")")
                            // text above
                            var avatar_text_g = svg.append("g")
                                .attr("id", "tr-image-avatar-text-g")
                                .attr("transform", "translate(" + item.cx + "," + (item.cy - avatar_yoff - avatar_radius - 15) + ")")
                            var text_bg = avatar_text_g.append("rect")
                                .attr("height", 24)
                                .style("rx", 3)
                                .style("ry", 3)
                                .style("fill", "white")
                            var text_name = avatar_text_g.append("text")
                                .text(name)
                                .style("font-family", "NotoSans, NotoSansEng")
                                .style("font-size", 12)
                                .style("font-weight", "bold")
                                .style("dominant-baseline", "middle")
                            var nc = parseInt(animate_data[name][scene_id].value / 2)
                            var text_n = avatar_text_g.append("text")
                                .text(nc + " สมัย")
                                .style("font-family", "NotoSans, NotoSansEng")
                                .style("font-size", 12)
                                .style("dominant-baseline", "middle")
                            var len_name = text_name.node().getBoundingClientRect().width
                            var len_n = text_n.node().getBoundingClientRect().width
                            var len_total = 10 + len_name + 5 + len_n + 5 + nc * 6 + (nc - 1) * 2 + 10
                            text_name.attr("x", parseInt(10 + -1 * len_total / 2))
                            text_n.attr("x", parseInt(10 + -1 * len_total / 2 + len_name + 5))
                            text_bg.attr("width", len_total)
                                .attr("x", parseInt(-1 * len_total / 2))
                                .attr("y", -15 + 1)
                                .style("stroke", "black")
                                .style("stroke-width", 1)

                            for (var i = 0; i < nc; i++) {
                                avatar_text_g.append("circle")
                                    .attr("r", 3)
                                    .attr("cy", 0)
                                    .attr("cx", parseInt(10 + -1 * len_total / 2 + len_name + 5 + len_n + 5 + i * (6 + 2)))
                                    .attr("fill", coreColors[response[0].name2app[name][i]])
                            }

                        })
                        circle.on("mouseout", function () { // mouse leave
                            // remove border
                            circle.style("stroke", "none")
                            // remove image
                            defs.selectAll("*").remove()
                            d3.select("#tr-image-avatar-bg").remove()
                            d3.select("#tr-image-avatar" + name.split(" ").join("-")).remove()
                            // remove text above
                            d3.select("#tr-image-avatar-text-g").remove()
                        })

                    }
                })

            }
            function initMouseover() {
                addMouseover(62)
            }

        });

    </script>

</body>

<style>
    /* main browser content */

    @font-face {
        font-family: NotoSans;
        src: url("page/src/assets/NotoSansThai-hinted/NotoSansThai-Regular.ttf");
    }

    @font-face {
        font-family: NotoSansEng;
        src: url("page/src/assets/NotoSans-hinted/NotoSans-Regular.ttf")
    }

    @font-face {
        font-family: TheMATTER;
        src: url("page/src/assets/TheMATTER/TheMATTER-Bold.otf");
    }

    @font-face {
        font-family: BaiJamjuree;
        src: url("page/src/assets/BaiJamjuree/BaiJamjuree-Regular.ttf");
    }

    #header,
    #intro,
    #part-1,
    #part-2,
    #intermission,
    #outro,
    #bibliography,
    #narrative-intro {
        position: relative;
        width: 100%;
        align-items: center;
        display: flex;
        flex-direction: column;
    }

    #header {
        height: 375px;
    }

    #header-suptitle,
    #header-title,
    #header-subtitle {
        text-align: center;
        position: absolute;
    }

    #header-suptitle {
        font-family: TheMATTER;
        font-style: normal;
        font-weight: bold;
        font-size: 16px;
        line-height: 27px;
        /* padding-top: 75px; */
        top: 75px;
    }

    #header-title {
        font-family: TheMATTER;
        font-weight: bold;
        font-size: 36px;
        line-height: 120%;
        /* padding-top: 20px; */
        top: 134px;
    }

    #header-subtitle {
        font-family: BaiJamjuree;
        font-size: 16px;
        line-height: 150%;
        /* padding-top: 20px; */
        top: 257px;
    }

    #intro {
        height: 1368px;
        width: 100%;
    }

    .intro-text {
        position: relative;
        width: 46.8%;
        font-family: BaiJamjuree;
        font-size: 16px;
        line-height: 150%;
        /* height: a */
    }

    #intro-split-box {
        position: relative;
        width: 560px;
        height: 205px;
        padding-top: 40px;
    }

    #intro-split-box-1 {
        align-items: center;
        position: relative;
        width: 50%;
        height: 100%;
        left: 0px;
        /* border-right: 4px solid #e0e0e0; */
        display: inline-block;
    }

    #intro-split-box-2 {
        align-items: center;
        position: relative;
        width: 48%;
        height: 100%;
        right: 0px;
        border-left: 4px solid #e0e0e0;
        display: inline-block;
    }

    #intro-split-box-title-1 {
        text-align: center;
        position: absolute;
        width: 100%;
        top: 0px;
        font-family: NotoSans, NotoSansEng;
        font-weight: bold;
        font-size: 16px;
        height: 40px;
        line-height: 20px;
    }

    #intro-split-box-title-2 {
        text-align: center;
        position: absolute;
        width: 100%;
        top: 0px;
        font-family: NotoSans, NotoSansEng;
        font-weight: bold;
        font-size: 16px;
        height: 40px;
        line-height: 40px;
    }

    #intro-boxes-core {
        position: relative;
        width: 550px;
        height: 41px;
        padding-top: 40px;
    }

    .intro-box-core {
        position: relative;
        width: 170px;
        height: 41px;
        text-align: center;
        line-height: 41px;
        font-family: NotoSans, NotoSansEng;
        font-weight: bold;
        font-size: 16px;
        display: inline-block;
    }

    #intro-lottie {
        position: relative;
        width: 78%;
        /* height: 373px; */
        padding-top: 40px;
    }

    .headbox {
        display: inline-block;
        position: relative;
        width: 150px;
        height: 100%;
        text-align: center;
    }

    .headshot {
        width: 80px;
        border-radius: 50%;
    }

    .headtext {
        width: 100%;
        font-family: BaiJamjuree;
        font-weight: bold;
        font-size: 14px;
        line-height: 150%;
        text-align: center;
        bottom: 0px;
    }

    .part-title {
        position: relative;
        width: 46.8%;
        padding-top: 75px;
        font-family: TheMATTER;
        font-weight: bold;
        font-size: 28px;
        line-height: 130%;
        text-align: center;
    }

    .part-text {
        position: relative;
        width: 46.8%;
        font-family: BaiJamjuree;
        font-size: 16px;
        line-height: 150%;
        text-align: center;
    }

    #part-1 {
        height: 1622px;
    }

    #part-1-headrow-1 {
        height: 113px;
        width: 624px;
        position: relative;
        padding-top: 40px;
    }

    #part-1-headrow-2 {
        height: 113px;
        width: 306px;
        position: relative;
        padding-top: 40px;
    }

    #part-1-headrow-3 {
        height: 113px;
        width: 306px;
        position: relative;
        padding-top: 80px;
    }

    #part-2 {
        height: 2508px;
    }

    .part-2-subtitle {
        position: relative;
        width: 46.8%;
        font-family: TheMATTER;
        font-weight: bold;
        font-size: 21px;
        line-height: 130%;
    }

    #part-2-headrow-1 {
        height: 113px;
        width: 459px;
        position: relative;
        padding-top: 40px;
    }

    #part-2-headrow-2 {
        height: 113px;
        width: 459px;
        position: relative;
        padding-top: 40px;
    }

    #part-2-headrow-3 {
        height: 113px;
        width: 459px;
        position: relative;
        padding-top: 40px;
    }

    #part-2-headrow-4 {
        height: 113px;
        width: 612px;
        position: relative;
        padding-top: 40px;
    }

    #narrative-intro {
        height: 140px;
    }

    #narrative-intro-text-1 {
        text-align: center;
        display: flex;
        justify-content: flex-end;
        align-items: flex-end;
        height: 79px;
        top: 12px;
        position: absolute;
        font-family: BaiJamjuree;
        font-size: 16px;
        line-height: 150%;
    }

    #narrative-intro-text-2 {
        text-align: center;
        bottom: 0px;
        position: absolute;
        font-family: BaiJamjuree;
        font-size: 12px;
        line-height: 150%;
    }

    #narrative-1 {
        position: relative;
        width: 100%;
        height: 800px;
        overflow-x: scroll;
        overflow-y: visible;
    }

    #narrative-1-card {
        position: relative;
        width: 100%;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.2s ease-out;
    }

    #intermission {
        height: 363px;
    }

    #intermission-title,
    #intermission-text,
    #intermission-subtext {
        position: relative;
        width: 46.8%;
        text-align: center;
    }

    #intermission-title {
        font-family: TheMATTER;
        font-weight: bold;
        font-size: 28px;
        line-height: 130%;
        padding-top: 75px;
    }

    #intermission-text {
        font-family: BaiJamjuree;
        font-size: 16px;
        line-height: 150%;
        padding-top: 40px;
    }

    #intermission-subtext {
        font-family: BaiJamjuree;
        font-size: 12px;
        line-height: 150%;
        color: rgba(0, 0, 0, 0.6);
        padding-top: 40px;
    }

    #narrative-2 {
        width: 100%;
        height: 800px;
        align-items: center;
        text-align: center;
    }

    #narrative-2-svg {
        width: 900px;
        height: 100%;
        left: calc(50% - 450px);
        position: absolute;
    }

    #outro {
        width: 100%;
        height: 722px;
    }

    #outro-headrow-1 {
        height: 113px;
        width: 150px;
        position: relative;
        padding-top: 75px;
    }

    #outro-headrow-2 {
        height: 113px;
        width: 306px;
        position: relative;
        padding-top: 40px;
    }

    .outro-text {
        position: relative;
        width: 46.8%;
        font-family: BaiJamjuree;
        font-size: 16px;
        line-height: 150%;
        text-align: center;
    }

    #bibliography {
        height: 275px;
    }

    #bibliography-title,
    #bibliography-text {
        position: absolute;
        width: 46.8%;
        font-family: BaiJamjuree;
        font-size: 12px;
        line-height: 150%;
    }

    #bibliography-title {
        top: 75px;
        font-weight: bold;
    }

    #bibliography-text {
        top: 117px;
    }

    /* triangle narrative */

    #narrative-2 text {
        font-family: "ProximaNova", Helvetica, Arial, sans-serif;
        font-size: 12px;
    }

    #tr-overlay-triangle {
        top: 64.5px;
        left: 64.5px;
    }

    .tr-track,
    .tr-track-inset,
    .tr-track-overlay {
        stroke-linecap: round;
    }

    .tr-track {
        stroke: #000;
        stroke-opacity: 0.3;
        stroke-width: 8px;
    }

    .tr-track-inset {
        stroke: #dcdcdc;
        stroke-width: 8px;
    }

    .tr-track-overlay {
        pointer-events: stroke;
        stroke-width: 50px;
        stroke: transparent;
        cursor: crosshair;
    }

    .tr-handle {
        fill: #fff;
        stroke: #000;
        stroke-opacity: 0.5;
        stroke-width: 1.25px;
    }

    /* line narrative */

    #li-narrative-chart {
        position: absolute;
        top: 120px;
    }

    #narrative-1 text {
        font-family: NotoSans, NotoSansEng;
        font-size: 9px;
    }

    #narrative-1 rect {
        fill: none;
        stroke: #000;
    }

    #narrative-1 path {
        fill: none;
        stroke-width: 4;
        stroke: #333;
    }

    .li-intro text:first-child {
        fill: #fff;
        stroke: #f9f9f9;
        stroke-width: 3;
    }

    .li-intro text+text {
        fill: #333;
        font-size: 9px;
    }

    #li-charcard-accordion {
        left: 1000px;
        top: 1400px;
        position: absolute;
        z-index: 100;
    }

    #li-scenecard,
    #li-charcard {
        position: absolute;
        top: 30px;
        left: 60px;
        height: 350px;
        width: 1160px;
        background-color: white;
        border: solid 2px black;
        border-radius: 15px;
        visibility: hidden;
        transition: max-height 0.2s ease-out;
    }

    #li-scenecard-name,
    #li-charcard-name {
        position: absolute;
        font-family: TheMATTER;
        font-weight: bold;
        font-size: 28px;
        top: 75px;
        left: 230px;
        transform: translate(-50%, -50%);
    }

    #li-charcard-name {
        top: 68px;
    }

    #li-scenecard-t1 {
        position: absolute;
        font-family: NotoSans, NotoSansEng;
        font-size: 16px;
        top: 287px;
        left: 230px;
        text-align: center;
        transform: translate(-50%, -50%);
    }

    #li-scenecard-ac {
        position: absolute;
        left: 420px;
        top: 56.5px;
        width: 205px;
        height: auto;
    }

    .li-scenecard-ac-button {
        font-family: TheMATTER;
        font-size: 10px;
        background-color: white;
        border-top: none;
        border-left: none;
        border-right: none;
        border-bottom: solid 2px #e0e0e0;
        outline: none;
        color: black;
        padding-top: 8px;
        padding-bottom: 8px;
        padding-left: 23px;
        width: 100%;
        transition: 0.2s;
        text-align: left;
        cursor: pointer;
    }

    .li-scenecard-ac-panel {
        font-family: NotoSans, NotoSansEng;
        font-size: 14px;
        padding: 0 18px;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.2s ease-out;
    }

    #li-scenecard-img,
    #li-charcard-img {
        position: absolute;
        height: 100px;
        width: 100px;
        /* text-anchor: middle;
        vertical-align: middle; */
        top: 137px;
        left: 180px;
        /* transform: translate(-50%, -50%); */
        border-radius: 50px;
    }

    #li-charcard-img {
        top: 126px;
    }

    #li-scenecard-t2 {
        position: absolute;
        font-family: NotoSans, NotoSansEng;
        font-size: 16px;
        left: 665px;
        top: 50px;
        width: 415px;
        height: auto;
    }

    #li-charcard-b1 {
        position: absolute;
        font-family: NotoSans, NotoSansEng;
        font-size: 12px;
        background-color: white;
        border: solid 1px black;
        outline: none;
        color: black;
        padding-top: 8px;
        padding-bottom: 8px;
        padding-left: 20px;
        padding-right: 20px;
        top: 266px;
        left: 166px;
        text-align: center;
        border-radius: 5px;
        text-decoration: none;
        visibility: hidden;
    }

    #li-charcard-subtext1,
    #li-charcard-subtext2 {
        position: absolute;
        font-family: NotoSans, NotoSansEng;
        font-size: 12px;
        color: #828282;
        top: 94px;
    }

    #li-charcard-subtext1 {
        left: 421px;
    }

    #li-charcard-subtext2 {
        left: 466px;
    }

    #li-charcard-expand {
        position: absolute;
        left: 420px;
        top: 54px;
        width: 320px;
        height: auto;
    }

    #li-charcard-expand-title {
        position: absolute;
        font-family: TheMATTER;
        font-size: 24px;
        top: 0px;
        left: 0px;
    }

    #li-charcard-expand-content-svg {
        position: absolute;
        top: 54px;
        width: 100%;
        height: auto;
    }

    .li-charcard-expand-content-text {
        font-family: NotoSans, NotoSansEng;
        font-size: 16px;
        overflow: visible;
    }

    #li-charcard-t2 {
        position: absolute;
        font-family: NotoSans, NotoSansEng;
        font-size: 16px;
        left: 780px;
        top: 50px;
        width: 300px;
        height: auto;
    }
</style>